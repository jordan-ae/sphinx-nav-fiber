import{a7 as D,bX as k,bY as h,bZ as F,s as B,T as C,F as d,al as $,r as w,g as E,j as n,aW as z,aX as R,B as S,a1 as V,i as A,k as G,aU as I}from"./index-df66d2e5.js";import{e as K}from"./index-4fd7a16d.js";import{A as M}from"./index-3153875e.js";const _="https://community.sphinx.chat",N=async e=>await D.post("/bounty",JSON.stringify(e)),W=async e=>await k(`${_}/person/${e}`,{headers:{"Content-Type":"application/json"},method:"GET"}),O=async e=>await k(`${_}/workspaces/user/${e}`,{headers:{"Content-Type":"application/json"},method:"GET"});async function P(){try{const e=Math.floor(Date.now()/1e3),t=h.Buffer.from(e.toString(16),"hex"),a=h.Buffer.from(t).toString("base64"),l=await F.signMessage(a),o=q(l.signature),r=h.Buffer.concat([t,o],o.length+t.length);return L(r)}catch(e){return console.log("error from signing more message: ",e),""}}function q(e){const t=e.replace(/_/g,"/").replace(/-/g,"+"),a=t.padEnd(t.length+(4-t.length%4)%4,"=");return h.Buffer.from(a,"base64")}function L(e){let t="";const a=e.byteLength;for(let o=0;o<a;o+=1)t+=String.fromCharCode(e[o]);return btoa(t).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}const U=/^[0-9]+$/,X=e=>{const t=e.trim();return!!(t&&U.test(t))},H=({errMessage:e,handleClose:t})=>{const{setValue:a,watch:l}=$(),[o,r]=w.useState([]),{pubKey:g}=E();w.useEffect(()=>{async function s(){try{const i=await W(g);if(!i.id){r([{label:"SecondBrain",value:"SecondBrain"}]);return}const u=await O(i.id);if(u.length>0){const p=[];for(let m=0;m<u.length;m+=1){const j=u[m];p.push({label:j.name,value:j.uuid})}r(p)}}catch(i){console.error("Error from get user details: ",i)}}s()},[g]);const f=l("budget",""),y=l("nodeType",""),c=s=>{const i=(s==null?void 0:s.label)||"SecondBrain",u=(s==null?void 0:s.value)||"ck9drb84nncjnaefo090";a("nodeType",i,{shouldValidate:!0}),a("workspaceUuid",u)},b=X(f)&&!!y,x=s=>{s.key===" "&&s.preventDefault()};return n.jsxs(d,{children:[n.jsx(d,{align:"center",direction:"row",justify:"space-between",mb:18,children:n.jsx(J,{children:"Create Bounty"})}),n.jsxs(d,{mb:20,children:[n.jsx(T,{children:"Select Workspace"}),n.jsx(M,{autoFocus:!0,onSelect:c,options:o})]}),n.jsxs(d,{mb:20,children:[n.jsx(T,{children:"Set Budget"}),n.jsx(z,{id:"budget",name:"budget",onKeyDown:x,placeholder:"Enter budget",rules:{...R,pattern:{value:U,message:"Please enter a valid number"}},value:f})]}),n.jsxs(d,{direction:"row",children:[n.jsx(d,{grow:1,children:n.jsx(S,{color:"secondary",onClick:()=>t(),size:"large",variant:"contained",children:"Cancel"})}),n.jsx(d,{grow:1,ml:20,children:n.jsx(S,{color:"secondary",disabled:!b,size:"large",type:"submit",variant:"contained",children:"Confirm"})})]}),e&&n.jsx(Y,{children:e})]})},T=B(C)`
  font-size: 14px;
  font-weight: 600;
  font-family: 'Barlow';
  margin-bottom: 6px;
`,J=B(C)`
  font-size: 18px;
  font-weight: 600;
  font-family: 'Barlow';
  margin-bottom: 6px;
`,Y=B(d)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`,ee=({setBounty:e,cancelBounty:t})=>{const[a,l]=w.useState(""),{close:o}=V("createBounty"),r=K(),{pubKey:g}=E(),f=A({mode:"onChange"}),{handleSubmit:y,setValue:c}=f,b=()=>{c("budget",""),c("nodeType",""),c("workspaceUuid",""),t?t():o()},x=async s=>{const{budget:i,workspaceUuid:u}=s;try{const p=await P(),m={type:"code_generation",amount:Number(i),workspace_uuid:u||"ck9drb84nncjnaefo090",ref_id:r==null?void 0:r.ref_id,node_data:(r==null?void 0:r.properties)||{},jwt_token:p,pub_key:g};e?e(m):(await N(m),I("Bounty Created"))}catch(p){l(p)}finally{c("budget",""),c("nodeType",""),c("workspaceUuid",""),o()}};return n.jsx(G,{...f,children:n.jsx("form",{id:"create-bounty-form",onSubmit:y(x),children:n.jsx(H,{errMessage:a,handleClose:b})})})};export{ee as B};
