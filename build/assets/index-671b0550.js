import{j as e,s as d,g as S,F as v,T as ne,r as o,o as ie,c as Y,A as ae,p as ce,i as le,q as pe,t as de,f as D}from"./index-72c43584.js";import{Universe as ue}from"./index-96141f29.js";import{a as F,b as fe,c as he,I as ge,d as U,e as L,u as xe}from"./index-4c05f7ad.js";import{M as me,V as ye}from"./VolumeIcon-a6782a5e.js";import{S as we,R as Ce,s as q,M as be}from"./index-0dfd50aa.js";import"./index-538491ba.js";import"./VisibilityOn-94c75e85.js";import"./SourcesTableIcon-d8198314.js";import"./NodeCircleIcon-cfb2bd77.js";import"./CheckIcon-3c147a06.js";import"./DeleteNodeIcon-cd8806fe.js";import"./EditNodeIcon-30d5be30.js";import"./SearchIcon-7c0a843d.js";import"./SoundIcon-431289ae.js";import"./SucessFeedBackIcon-b812c2ed.js";import"./three.module-1c1ec8b9.js";import"./TextareaAutosize-085126f7.js";import"./index-60910992.js";import"./index-12eb2cb3.js";import"./index-3c53c3b6.js";import"./ClipLoader-190bab72.js";import"./Skeleton-d63422cd.js";import"./Stack-67dc24d9.js";import"./index-054ab67d.js";import"./isPlainObject-d0504c63.js";import"./Typography-daedb7f3.js";import"./createSvgIcon-a7ba44f6.js";function V(t){const[i,s,r]=t.split(":").map(Number);return Number((i*60*60*1e3+s*60*1e3+r*1e3).toFixed(6))}const je=t=>e.jsxs("svg",{width:"1em",height:"1em",viewBox:"0 0 30 28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M7.2998 2.55199C7.2998 1.51094 8.11675 0.666992 9.1245 0.666992H12.1299C13.1376 0.666992 13.9546 1.51094 13.9546 2.55199C13.9546 3.59305 13.1376 4.43699 12.1299 4.43699H9.1245C8.11675 4.43699 7.2998 3.59305 7.2998 2.55199Z",fill:"currentColor"}),e.jsx("path",{d:"M7.2998 25.449C7.2998 26.49 8.11675 27.334 9.1245 27.334H12.1299C13.1376 27.334 13.9546 26.49 13.9546 25.449C13.9546 24.4079 13.1376 23.564 12.1299 23.564H9.1245C8.11675 23.564 7.2998 24.4079 7.2998 25.449Z",fill:"currentColor"}),e.jsx("path",{d:"M2.79102 8.29613C2.79102 7.25508 3.60796 6.41113 4.61571 6.41113H12.1292C13.1369 6.41113 13.9539 7.25508 13.9539 8.29613C13.9539 9.33719 13.1369 10.1811 12.1292 10.1811H4.61571C3.60796 10.1811 2.79102 9.33719 2.79102 8.29613Z",fill:"currentColor"}),e.jsx("path",{d:"M2.79102 19.7039C2.79102 20.7449 3.60796 21.5889 4.61571 21.5889H12.1292C13.1369 21.5889 13.9539 20.7449 13.9539 19.7039C13.9539 18.6628 13.1369 17.8189 12.1292 17.8189H4.61571C3.60796 17.8189 2.79102 18.6628 2.79102 19.7039Z",fill:"currentColor"}),e.jsx("path",{d:"M0 14.094C0 13.0529 0.816945 12.209 1.8247 12.209H12.1289C13.1366 12.209 13.9536 13.0529 13.9536 14.094C13.9536 15.135 13.1366 15.979 12.1289 15.979H1.8247C0.816946 15.979 0 15.135 0 14.094Z",fill:"currentColor"}),e.jsx("path",{d:"M22.7002 25.448C22.7002 26.4891 21.8833 27.333 20.8755 27.333H17.8701C16.8624 27.333 16.0454 26.4891 16.0454 25.448C16.0454 24.407 16.8624 23.563 17.8701 23.563H20.8755C21.8832 23.563 22.7002 24.407 22.7002 25.448Z",fill:"currentColor"}),e.jsx("path",{d:"M22.7002 2.55199C22.7002 1.51094 21.8833 0.666992 20.8755 0.666992H17.8701C16.8624 0.666992 16.0454 1.51094 16.0454 2.55199C16.0454 3.59305 16.8624 4.43699 17.8701 4.43699H20.8755C21.8832 4.43699 22.7002 3.59305 22.7002 2.55199Z",fill:"currentColor"}),e.jsx("path",{d:"M27.209 19.7029C27.209 20.7439 26.392 21.5879 25.3843 21.5879H17.8708C16.8631 21.5879 16.0461 20.7439 16.0461 19.7029C16.0461 18.6618 16.8631 17.8179 17.8708 17.8179H25.3843C26.392 17.8179 27.209 18.6618 27.209 19.7029Z",fill:"currentColor"}),e.jsx("path",{d:"M27.209 8.29613C27.209 7.25508 26.392 6.41113 25.3843 6.41113H17.8708C16.8631 6.41113 16.0461 7.25508 16.0461 8.29613C16.0461 9.33719 16.8631 10.1811 17.8708 10.1811H25.3843C26.392 10.1811 27.209 9.33719 27.209 8.29613Z",fill:"currentColor"}),e.jsx("path",{d:"M30 14.093C30 13.052 29.1831 12.208 28.1753 12.208H17.8711C16.8634 12.208 16.0464 13.052 16.0464 14.093C16.0464 15.1341 16.8634 15.978 17.8711 15.978H28.1753C29.1831 15.978 30 15.1341 30 14.093Z",fill:"currentColor"})]}),ve=()=>e.jsxs(Se,{children:[e.jsx(ke,{children:e.jsx(Te,{children:e.jsx(je,{})})}),e.jsx(Ie,{children:"Graph Mindset"})]}),Se=d(v).attrs({align:"center",direction:"row",grow:1,justify:"flex-start"})`
  height: 64px;
  box-sizing: border-box;
  padding: 20px 23px;
  gap: 0px;
  z-index: 50;
  position: relative;
`,ke=d(v)`
  align-items: center;
  justify-content: center;
  cursor: pointer;
`,Te=d.div`
  display: flex;
  align-items: center;
  justify-content: center;

  svg {
    width: 30px;
    height: 27px;
    color: ${S.white};
  }
`,Ie=d(ne)`
  width: 127px;
  height: 24px;
  color: ${S.white};
  font-family: Barlow;
  font-size: 22px;
  font-style: normal;
  font-weight: 700;
  line-height: 24px;
  letter-spacing: 0.22px;
  margin-left: 16px;
  white-space: nowrap;
`,J=o.memo(()=>{const t=F(a=>a.isPlaying),i=F(a=>a.setIsPlaying),s=F(a=>a.setVolume),r=F(a=>a.setPlaybackSpeed),c=F(a=>a.playbackSpeed),n=F(a=>a.playerRef),[m,w]=o.useState(!1),h=[.5,1,1.5,2],x=()=>{if(n){const a=n.getCurrentTime()-15;n.seekTo(a,"seconds")}},l=()=>{if(n){const a=n.getCurrentTime()+15;n.seekTo(a,"seconds")}},j=()=>{i(!t)},p=()=>{w(!m),s(m?1:0)},g=()=>{const k=(h.indexOf(c)+1)%h.length,I=h[k];if(r(I),n){const P=n.getInternalPlayer();P&&typeof P.playbackRate<"u"&&(P.playbackRate=I)}};return e.jsxs(Me,{children:[e.jsx(Ee,{onClick:p,children:m?e.jsx(me,{}):e.jsx(ye,{})}),e.jsx($e,{onClick:x,children:e.jsx("img",{alt:"",src:"/RewindIcon.svg"})}),e.jsx(Pe,{"data-testid":"play-pause-button",onClick:j,size:"small",children:t?e.jsx(fe,{"data-testid":"pause-icon"}):e.jsx(he,{"data-testid":"play-icon"})}),e.jsx(_e,{onClick:l,children:e.jsx("img",{alt:"",src:"/ForwardIcon.svg"})}),e.jsxs(Re,{onClick:g,children:[c,"x"]})]})});J.displayName="Controls";const Me=d(v).attrs({direction:"row",align:"center",justify:"flex-start"})`
  width: 200px;
  height: 54px;
  background: ${S.BG1};
  border-radius: 40px;
  margin-right: 30px;
  color: ${S.white};
  font-size: 20px;
  padding: 12px;
  justify-content: space-between;
  box-sizing: border-box;
`,Pe=d(ge)`
  && {
    font-size: 36px;
    padding: 2px;
    overflow: hidden;
  }
`,$e=d.div`
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 1px 0 0 1px;
  cursor: pointer;
  img {
    width: 20px;
    height: auto;
  }
`,_e=d.div`
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  img {
    width: 24px;
    height: auto;
  }
`,Ee=d.div`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  cursor: pointer;
  border-radius: 50%;
  transition: background-color 0.3s ease;
  color: ${S.GRAY6};

  svg {
    margin-top: 3px;
    width: 24px;
    height: 24px;
  }

  &:hover {
    background-color: ${S.DROPDOWN_BG};
  }
`,Re=d.button`
  margin-top: 4px;
  background: ${S.BG1};
  color: ${S.GRAY6};
  border: none;
  width: 8px;
  border-radius: 20px;
  padding: 8px 20px 8px 8px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s ease;
`,K=o.memo(({left:t,width:i,title:s})=>e.jsx(Ne,{style:{left:`${t}%`,width:`calc(${i}%)`},children:e.jsx("div",{className:"title",children:s})}));K.displayName="Chapter";const Ne=d.div`
  position: absolute;
  top: -3px;
  height: 100%;
  top: 0%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;

  & + & {
    border-left: 0.1px solid ${S.white};
  }

  .title {
    position: absolute;
    bottom: calc(100% + 16px);
    display: none;
    color: ${S.white};
    text-align: center;
    left: 50%;
    transform: translateX(-50%);
  }

  &:hover {
    background-color: rgba(255, 255, 255, 0.2);
    .title {
      display: block;
    }
  }
`,Q=o.memo(({chapters:t,duration:i})=>i?e.jsx(e.Fragment,{children:t.map((s,r)=>{var x,l,j,p;const c=(x=s==null?void 0:s.properties)!=null&&x.timestamp?V(s.properties.timestamp)/1e3:0,n=(j=(l=t[r+1])==null?void 0:l.properties)!=null&&j.timestamp?V((p=t[r+1].properties)==null?void 0:p.timestamp)/1e3:i,m=Math.floor(c/i*100),h=Math.floor(n/i*100)-m;return e.jsx(K,{left:m,title:s.name,width:h},`${s.ref_id}_${r}`)})}):null);Q.displayName="Chapters";const ee=o.memo(({type:t,left:i,img:s})=>{var h,x;const r=ie(l=>l.normalizedSchemasByType),c=(h=r[t])==null?void 0:h.primary_color,n=(x=r[t])==null?void 0:x.icon,m=n?`/svg-icons/${n}.svg`:"",w={iconStart:s||m,color:c??S.THING};return e.jsx(We,{style:{left:`${i}%`},children:e.jsx(te,{...w,label:t})})});ee.displayName="Marker";const te=o.memo(({iconStart:t,color:i,label:s})=>e.jsx(He,{color:i,children:t&&e.jsx("img",{alt:s,className:"badge__img",onError:console.log,src:t})}));te.displayName="Badge";const He=d(v).attrs({direction:"row"})`
  cursor: pointer;
  background: ${({color:t})=>t};
  border-radius: 3px;
  overflow: hidden;
  justify-content: center;
  align-items: center;

  .badge__img {
    width: 10px;
    height: 10px;
    object-fit: contain;
  }
`,We=d.div`
  position: absolute;
  top: -6px;
  width: 12px;
  height: 12px;
  border-radius: 4px;
  background-color: ${S.white};
  transform: translateX(-50%);
  transform: translateX(-50%) translateY(-50%);
  top: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
`,re=o.memo(({markers:t,duration:i})=>e.jsx(e.Fragment,{children:t.map((s,r)=>{var w;const c=Math.floor(((s==null?void 0:s.start)||0)/i*100),n=(s==null?void 0:s.node_type)||"",m=((w=s==null?void 0:s.properties)==null?void 0:w.image_url)||"";return e.jsx(ee,{img:m,left:c,type:n},`${s.ref_id}_${r}`)})}));re.displayName="Markers";const Fe=({duration:t,markers:i,handleProgressChange:s,playingTIme:r,chapters:c})=>{const n=10/t*100;return e.jsxs(Be,{children:[e.jsx(ze,{max:t,onChange:s,value:r,width:n}),c&&e.jsx(se,{children:e.jsx(Q,{chapters:c,duration:t})}),e.jsx(Ae,{children:e.jsx(re,{duration:t,markers:i})})]})},se=d(v)`
  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  height: 96px;
  transform: translateY(-50%);
`,Be=d(v)`
  position: relative;
  flex: 1 1 100%;

  &:hover {
    ${se} {
      display: block;
    }
  }
`,Ae=d(v)`
  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
`,ze=d(we)`
  && {
    z-index: 20;
    color: ${S.white};
    height: 3px;
    width: calc(100% - 12px);
    box-sizing: border-box;
    .MuiSlider-track {
      border: none;
    }
    .MuiSlider-thumb {
      width: ${({width:t})=>`${t}%`};
      height: 54px;
      border-radius: 8px;
      background-color: ${S.primaryBlue};
      opacity: 0.2;
      &:before {
        box-shadow: '0 4px 8px rgba(0,0,0,0.4)';
      }
      &:hover,
      &.Mui-focusVisible,
      &.Mui-active {
        box-shadow: none;
      }
    }
  }
`,Ge=({markers:t,chapters:i})=>{const{playingNode:s,playerRef:r}=F(x=>x),[c,n]=o.useState(0),m=s,w=o.useCallback((x,l)=>{const j=Array.isArray(l)?l[0]:l;r&&r.seekTo(j,"seconds")},[r]);o.useEffect(()=>{const x=setInterval(()=>{if(r&&n){const l=r.getCurrentTime();n(l)}},500);return()=>clearInterval(x)},[r,n]);const h=(r==null?void 0:r.getDuration())||0;return m?e.jsxs(Le,{children:[e.jsx(J,{}),e.jsx(Fe,{chapters:i,duration:h,handleProgressChange:w,markers:t,playingTIme:c})]}):null},Le=d(v).attrs({direction:"row",align:"center",justify:"space-between"})`
  padding: 20px;
  background: ${S.BG2};
  height: 96px;
  /* margin-top: 16px; */
  border-radius: 8px;
  box-sizing: border-box;
  margin-right: 4px;
`,Ze=(t,i)=>{let s=0,r=t.length-1;for(;s<=r;){const c=Math.floor((s+r)/2),n=t[c],{start:m,end:w}=n.properties;if(i>=m&&i<=w)return n;i<m?r=c-1:s=c+1}return null},Ve=({mediaUrl:t})=>{const i=o.useRef(null),[s,r]=o.useState("ready"),[c,n]=o.useState(!1),{setActiveEdge:m}=U(C=>C),{dataInitial:w}=Y(C=>C),{isPlaying:h,playingTime:x,setIsPlaying:l,setPlayingTime:j,setDuration:p,playingNode:g,volume:a,setHasError:k,resetPlayer:I,isSeeking:P,setIsSeeking:z,setPlayerRef:$,playerRef:H,playbackSpeed:O}=F(C=>C);o.useEffect(()=>()=>I(),[I]),o.useEffect(()=>{g&&!c&&(j(0),p(0),n(!1))},[g,j,p,n,c]),o.useEffect(()=>{P&&H&&(H.seekTo(x,"seconds"),z(!1))},[x,P,z,H]);const u=o.useCallback(()=>{l(!h)},[h,l]),f=()=>{k(!0),r("error")},y=o.useCallback(C=>{C.code},[u]);o.useEffect(()=>(window.addEventListener("keydown",y),()=>{window.removeEventListener("keydown",y)}),[y]);const M=o.useMemo(()=>((w==null?void 0:w.links.filter(T=>{var b;return(b=T==null?void 0:T.properties)==null?void 0:b.start}))||[]).slice().sort((T,b)=>{var B,Z;return((B=T==null?void 0:T.properties)==null?void 0:B.start)-((Z=b==null?void 0:b.properties)==null?void 0:Z.start)}),[w]),E=C=>{if(!P){const N=C.playedSeconds,T=Ze(M,N);m(T||null)}},_=()=>{H&&r("ready")},W=o.useCallback(()=>{h||l(!0)},[l,h]),R=o.useCallback(()=>{h&&l(!1)},[l,h]),G=C=>{C.stopPropagation()},A=o.useCallback(C=>{!H&&C&&$(C)},[$,H]);return t?e.jsxs(Oe,{ref:i,tabIndex:0,children:[e.jsx(De,{isFullScreen:!1,children:e.jsx(ae,{size:120,src:(g==null?void 0:g.image_url)||"",type:"clip"})}),e.jsx(Xe,{isFullScreen:!1,onClick:G,children:e.jsx(Ce,{ref:A,height:"219px",onBuffer:()=>r("buffering"),onBufferEnd:()=>r("ready"),onError:f,onPause:R,onPlay:W,onProgress:E,onReady:_,playbackRate:O,playing:h,url:t||"",volume:a,width:"100%"})}),s==="error"?e.jsx(qe,{className:"error-wrapper",children:"Error happened, please try later"}):null]}):null},Oe=d(v)`
  border-bottom: 1px solid rgba(0, 0, 0, 0.25);
  background: rgba(0, 0, 0, 0.2);
  position: relative;
  overflow: hidden;
  height: auto;
  &:focus {
    outline: none;
  }
`,De=d(v)`
  position: absolute;
  top: ${t=>t.isFullScreen?"38%":"18%"};
  left: 50%;
  transform: translateX(-50%);
  z-index: -1;
`,qe=d(v)`
  height: 60px;
  padding: 12px 16px;
  color: ${S.primaryRed};
`,Xe=d.div`
  margin: ${t=>t.isFullScreen?"80px auto":"0"};
  width: 100%;
  cursor: pointer;
`,Ye=o.memo(Ve),oe=o.forwardRef(({active:t,start:i,text:s},r)=>e.jsxs(Ue,{ref:r,className:ce({active:t}),children:[e.jsx(Je,{children:i}),e.jsx(Ke,{children:e.jsx("span",{children:s})})]}));oe.displayName="ParagraphComponent";const X=o.memo(oe,(t,i)=>t.active===i.active),Ue=d(v)`
  flex-direction: row;
  align-items: flex-start;
  font-size: 14px;
  padding: 8px 24px;
  &.active {
    background: ${S.AI_HIGHLIGHT};
  }
`,Je=d.span`
  background: ${S.lightBlue100};
  color: ${S.lightBlue500};
  padding: 2px;
  margin-right: 8px;
  border-radius: 4px;
`,Ke=d.div`
  margin: 0 2px;
  word-break: break-word;

  &.active {
    background: ${S.AI_HIGHLIGHT};
  }
`,Qe=({transcriptString:t,isFirst:i})=>{const[s,r]=o.useState(0),[c,n]=o.useState(!1),{playerRef:m}=F(p=>p),w=t.replace(/^["']|["']$/g,""),h=JSON.parse(w),x=o.useRef(null),l=o.useRef(null),j=o.useRef(null);return o.useEffect(()=>{const p=setInterval(()=>{if(m&&r){const g=m.getCurrentTime();r(g)}},100);return()=>clearInterval(p)},[m,r]),o.useEffect(()=>{const p=()=>{n(!0),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{n(!1)},1e3)},g=l.current;return g&&g.addEventListener("scroll",p),()=>{g&&g.removeEventListener("scroll",p)}},[]),o.useEffect(()=>{!c&&x.current&&x.current.scrollIntoView({behavior:"smooth",block:"center"})},[s,c]),e.jsx(et,{ref:l,children:e.jsx(e.Fragment,{children:i?e.jsx(e.Fragment,{children:h[0].start>s?e.jsx(X,{active:!1,start:q(h[0].start),text:h[0].text}):e.jsx(e.Fragment,{children:h.map(p=>{const g=q(p.start),a=p.start<s&&s<p.end;return!i||p.start<=s+5?e.jsx(X,{ref:a?x:null,active:a,start:g,text:p.text},`${p.start}-${p.end}`):null})})}):e.jsx(e.Fragment,{children:h.map(p=>{const g=q(p.start),a=p.start<s&&s<p.end;return e.jsx(X,{ref:a?x:null,active:a,start:g,text:p.text},`${p.start}-${p.end}`)})})})})},et=d.div`
  width: 100%;
  height: 100%;
  overflow: scroll;
  padding-right: 4px;
`,tt=({name:t})=>{var g;const i=L(a=>a.clips),{playerRef:s}=F(a=>a),[r,c]=o.useState(0),[n,m]=o.useState(null),[w,h]=o.useState(!0),[x,l,j]=U(a=>[a.setActiveNode,a.activeNode,a.simulation]);o.useEffect(()=>{const a=setInterval(()=>{if(s&&c){const k=s.getCurrentTime();c(k)}},100);return()=>clearInterval(a)},[s,c]),o.useEffect(()=>{r&&(()=>{var I;const k=i.find(P=>{var H;const[z,$]=p((H=P==null?void 0:P.properties)==null?void 0:H.timestamp);return z<=r&&r<$});n&&(k==null?void 0:k.ref_id)===(n==null?void 0:n.ref_id)||!k||(h((k==null?void 0:k.ref_id)===((I=i[0])==null?void 0:I.ref_id)),m(k||null))})()},[r,i,n]),o.useEffect(()=>{if(n&&(!l||n.ref_id!==l.ref_id)){const a=j==null?void 0:j.nodes().find(k=>k.ref_id===n.ref_id);typeof(a==null?void 0:a.fx)=="number"&&x(a)}},[n,l,x,j]);const p=a=>a?a.split("-").map(Number):[0,0];return e.jsxs(rt,{children:[e.jsx(v,{className:"heading",children:t}),n?e.jsx(st,{direction:"row",children:((g=n.properties)==null?void 0:g.transcript)&&e.jsx(Qe,{isFirst:w,transcriptString:n.properties.transcript})}):null]})},rt=d(v)`
  .heading {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 16px;
  }
  color: ${S.white};
  background: ${S.BG1};
  border-radius: 8px;
  padding: 24px;
  overflow-y: auto;
  flex: 1 1 100%;
`,st=d(v)`
  flex-wrap: wrap;
  flex: 1 1 100%;
  margin-left: -24px;
  margin-right: -24px;
`,ot=()=>{var i;const t=L(s=>s.selectedEpisode);return e.jsxs(nt,{align:"stretch",basis:"100%",grow:1,shrink:1,children:[e.jsx(it,{children:((i=t==null?void 0:t.properties)==null?void 0:i.source_link)&&e.jsx(Ye,{mediaUrl:t.properties.source_link})}),e.jsx(tt,{name:(t==null?void 0:t.name)||""})]})},nt=d(v)(({theme:t})=>({position:"relative",display:"flex",padding:"0 20px 0 20px",background:"transparent",width:"100%",height:"calc(100vh - 180px)",overflow:"auto",[t.breakpoints.up("sm")]:{width:be,gap:"10px"}})),it=d(v)(({theme:t})=>({width:"100%",marginBottom:"20px",[t.breakpoints.up("sm")]:{width:"390px",margin:"0 auto"}})),at=t=>{const i=t.edges.filter(r=>{var c;return(c=r==null?void 0:r.properties)==null?void 0:c.start}).map(r=>({source:r.source,target:r.target,start:r.properties.start}));return t.nodes.filter(r=>t.edges.some(c=>c.source===r.ref_id||c.target===r.ref_id)).map(r=>{const c=i.find(n=>r.ref_id===n.source||r.ref_id===n.target);return{...r,start:(c==null?void 0:c.start)||0}}).filter(r=>r&&r.node_type!=="Clip"&&r.node_type!=="Episode"&&r.node_type!=="Show")},At=()=>{const{isFetching:t,runningProjectId:i}=Y(u=>u),s=Y(u=>u.addNewNode),[r,c]=o.useState(!1),n=L(u=>u.setSelectedEpisode),m=L(u=>u.setClips),w=L(u=>u.clips),h=L(u=>u.setChapters),x=L(u=>u.chapters),l=xe(),j=o.useRef(null),p=o.useRef(null),g=o.useRef(null),[a,k]=o.useState([]),I=o.useRef(null),P=o.useRef(null),z=le(),{episodeId:$}=pe(),{setPlayingNode:H}=F(u=>u);o.useEffect(()=>{$&&(async f=>{try{const y=await de(f);y&&(H(y),n(y),s({nodes:[y],edges:[]}))}catch(y){z("/"),console.error(y)}})($)},[$,H,n,s,z]),o.useEffect(()=>{$&&(async()=>{try{const f=await D($||"",0,50,{nodeType:["Show","Host","Guest"],useSubGraph:!1}),y=await D($||"",0,1e3,{nodeType:["Clip"],useSubGraph:!1});if(s({nodes:f!=null&&f.nodes?f==null?void 0:f.nodes:[],edges:f!=null&&f.edges?f.edges:[]}),y!=null&&y.nodes){const M=y.nodes.filter(E=>{var _;return(_=E.properties)==null?void 0:_.timestamp}).sort((E,_)=>{var G,A,C,N;const W=Number((A=(G=E.properties)==null?void 0:G.timestamp)==null?void 0:A.split("-")[0]),R=Number((N=(C=_.properties)==null?void 0:C.timestamp)==null?void 0:N.split("-")[0]);return W-R});m(M)}}catch(f){z("/"),console.error("Error fetching initial data:",f)}})()},[$,s,m,z]),o.useEffect(()=>{$&&(async()=>{try{const f=await D($||"",0,50,{nodeType:["Chapter"],useSubGraph:!1});if(f!=null&&f.nodes){const y=f==null?void 0:f.nodes.filter(M=>M.node_type==="Chapter").sort((M,E)=>{var _,W;return V(((_=M==null?void 0:M.properties)==null?void 0:_.timestamp)||"")-V(((W=E==null?void 0:E.properties)==null?void 0:W.timestamp)||"")});h(y)}}catch{console.log("no chapters was fetched")}})()},[$,h]),o.useEffect(()=>{if(!w||!x)return;(async()=>{var f,y;try{const M=(w==null?void 0:w.map(W=>W.ref_id).filter(Boolean))||[],E=[],_={nodes:((f=g.current)==null?void 0:f.nodes)||[],edges:((y=g.current)==null?void 0:y.edges)||[]};for(const W of M){const R=await D(W,0,50);if(R){const A=at(R).map(C=>{var T;const N=((T=x.find(b=>{var B;return C.start&&V(((B=b==null?void 0:b.properties)==null?void 0:B.timestamp)||"")>=C.start*1e3}))==null?void 0:T.ref_id)||"";return{...C,neighbourHood:N}});_.nodes.push(...A||[]),_.edges.push(...(R==null?void 0:R.edges)||[]),E.push(...A),g.current=_}}k(E)}catch(M){console.error("Error processing clip nodes:",M)}})()},[w,k,x]);const O=o.useCallback(u=>{t||(I.current||(I.current={nodes:[],edges:[]}),u.edges&&I.current.edges.push(...u.edges),u.nodes&&I.current.nodes.push(...u.nodes),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{if(I.current){const{nodes:f,edges:y}=I.current,M={nodes:f,edges:y};I.current={nodes:[],edges:[]},s(M)}},3e3))},[s,t]);return o.useEffect(()=>(l&&(l.connect(),l.on("connect_error",u=>{console.error("Socket connection error:",u)}),i&&l.on("new_node_created",O)),()=>{l&&l.off()}),[l,O,i]),o.useEffect(()=>{const u=f=>{const{playerRef:y}=F.getState();if(p.current!==null){if(f-p.current>1e3){if(g.current&&y){const{nodes:E,edges:_}=g.current,W=y==null?void 0:y.getCurrentTime(),[R,G]=_.reduce(([N,T],b)=>{var B,Z;return((B=b==null?void 0:b.properties)==null?void 0:B.start)!==void 0&&((Z=b==null?void 0:b.properties)==null?void 0:Z.start)<W+1?N.push(b):T.push(b),[N,T]},[[],[]]),[A,C]=E.reduce(([N,T],b)=>(R.some(B=>B.target===b.ref_id||B.source===b.ref_id)?N.push(b):T.push(b),[N,T]),[[],[]]);g.current={nodes:C,edges:G},(A.length||R.length)&&s({nodes:A,edges:R})}p.current=f}}else p.current=f;j.current=requestAnimationFrame(u)};return j.current=requestAnimationFrame(u),()=>{j.current&&cancelAnimationFrame(j.current)}},[g,s]),o.useEffect(()=>{if(i)try{l==null||l.emit("update_project_id",{id:i})}catch(u){console.error(u)}},[i,l]),e.jsxs(ct,{children:[e.jsx(lt,{direction:"row",children:e.jsxs(e.Fragment,{children:[e.jsxs(v,{children:[e.jsx(v,{onClick:()=>c(!r),children:e.jsx(ve,{})}),e.jsx(ot,{})]}),e.jsx(pt,{children:e.jsx(v,{basis:"100%",grow:1,shrink:1,children:e.jsx(ue,{})})})]})}),e.jsx(dt,{children:e.jsx(Ge,{chapters:x,markers:a})})]})},ct=d.div`
  display: flex;
  flex-direction: column;
  height: 100vh;
  width: 100%;
`,lt=d(v)`
  flex: 1;
  overflow: hidden;
`,pt=d(v)`
  flex-basis: 100%;
  flex-shrink: 1;
  flex-grow: 1;
  padding: 16px 16px 16px 0;
`,dt=d(v)`
  padding: 16px 16px 16px 0;
  margin-left: 18px;
`;export{At as MindSet};
