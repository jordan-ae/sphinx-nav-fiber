import{j as e,s as f,g as v,F as j,T as ae,r as o,o as J,c as Y,A as ce,p as le,i as pe,q as de,t as ue,v as fe,f as O}from"./index-07edd55a.js";import{Universe as he}from"./index-c4a662ab.js";import{a as H,b as me,c as ge,I as xe,d as K,e as L,u as ye}from"./index-a10d75c3.js";import{M as we,V as Ce}from"./VolumeIcon-221c352a.js";import{S as be,R as je,s as q,M as ve}from"./index-e6bdba1f.js";import"./index-71f616b4.js";import"./VisibilityOn-051c75f9.js";import"./SourcesTableIcon-435cc6c4.js";import"./NodeCircleIcon-a08e264d.js";import"./CheckIcon-7472c0c7.js";import"./DeleteNodeIcon-db67195d.js";import"./EditNodeIcon-eef8b0d2.js";import"./SearchIcon-bf25d911.js";import"./SoundIcon-8f8fbf99.js";import"./SucessFeedBackIcon-3e626251.js";import"./three.module-1c1ec8b9.js";import"./TextareaAutosize-ee2fc0dd.js";import"./index-75328821.js";import"./index-3eb07796.js";import"./index-4c540f72.js";import"./ClipLoader-36f91b24.js";import"./Skeleton-61cce6b3.js";import"./Stack-226b5b1b.js";import"./index-c4b6cb3b.js";import"./FormControlLabel-6f4e875a.js";import"./Typography-e4847f7b.js";import"./createSvgIcon-2b4b5a12.js";import"./isPlainObject-5e1f5224.js";function Z(t){const[i,s,r]=t.split(":").map(Number);return Number((i*60*60*1e3+s*60*1e3+r*1e3).toFixed(6))}const Se=t=>e.jsxs("svg",{width:"1em",height:"1em",viewBox:"0 0 30 28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M7.2998 2.55199C7.2998 1.51094 8.11675 0.666992 9.1245 0.666992H12.1299C13.1376 0.666992 13.9546 1.51094 13.9546 2.55199C13.9546 3.59305 13.1376 4.43699 12.1299 4.43699H9.1245C8.11675 4.43699 7.2998 3.59305 7.2998 2.55199Z",fill:"currentColor"}),e.jsx("path",{d:"M7.2998 25.449C7.2998 26.49 8.11675 27.334 9.1245 27.334H12.1299C13.1376 27.334 13.9546 26.49 13.9546 25.449C13.9546 24.4079 13.1376 23.564 12.1299 23.564H9.1245C8.11675 23.564 7.2998 24.4079 7.2998 25.449Z",fill:"currentColor"}),e.jsx("path",{d:"M2.79102 8.29613C2.79102 7.25508 3.60796 6.41113 4.61571 6.41113H12.1292C13.1369 6.41113 13.9539 7.25508 13.9539 8.29613C13.9539 9.33719 13.1369 10.1811 12.1292 10.1811H4.61571C3.60796 10.1811 2.79102 9.33719 2.79102 8.29613Z",fill:"currentColor"}),e.jsx("path",{d:"M2.79102 19.7039C2.79102 20.7449 3.60796 21.5889 4.61571 21.5889H12.1292C13.1369 21.5889 13.9539 20.7449 13.9539 19.7039C13.9539 18.6628 13.1369 17.8189 12.1292 17.8189H4.61571C3.60796 17.8189 2.79102 18.6628 2.79102 19.7039Z",fill:"currentColor"}),e.jsx("path",{d:"M0 14.094C0 13.0529 0.816945 12.209 1.8247 12.209H12.1289C13.1366 12.209 13.9536 13.0529 13.9536 14.094C13.9536 15.135 13.1366 15.979 12.1289 15.979H1.8247C0.816946 15.979 0 15.135 0 14.094Z",fill:"currentColor"}),e.jsx("path",{d:"M22.7002 25.448C22.7002 26.4891 21.8833 27.333 20.8755 27.333H17.8701C16.8624 27.333 16.0454 26.4891 16.0454 25.448C16.0454 24.407 16.8624 23.563 17.8701 23.563H20.8755C21.8832 23.563 22.7002 24.407 22.7002 25.448Z",fill:"currentColor"}),e.jsx("path",{d:"M22.7002 2.55199C22.7002 1.51094 21.8833 0.666992 20.8755 0.666992H17.8701C16.8624 0.666992 16.0454 1.51094 16.0454 2.55199C16.0454 3.59305 16.8624 4.43699 17.8701 4.43699H20.8755C21.8832 4.43699 22.7002 3.59305 22.7002 2.55199Z",fill:"currentColor"}),e.jsx("path",{d:"M27.209 19.7029C27.209 20.7439 26.392 21.5879 25.3843 21.5879H17.8708C16.8631 21.5879 16.0461 20.7439 16.0461 19.7029C16.0461 18.6618 16.8631 17.8179 17.8708 17.8179H25.3843C26.392 17.8179 27.209 18.6618 27.209 19.7029Z",fill:"currentColor"}),e.jsx("path",{d:"M27.209 8.29613C27.209 7.25508 26.392 6.41113 25.3843 6.41113H17.8708C16.8631 6.41113 16.0461 7.25508 16.0461 8.29613C16.0461 9.33719 16.8631 10.1811 17.8708 10.1811H25.3843C26.392 10.1811 27.209 9.33719 27.209 8.29613Z",fill:"currentColor"}),e.jsx("path",{d:"M30 14.093C30 13.052 29.1831 12.208 28.1753 12.208H17.8711C16.8634 12.208 16.0464 13.052 16.0464 14.093C16.0464 15.1341 16.8634 15.978 17.8711 15.978H28.1753C29.1831 15.978 30 15.1341 30 14.093Z",fill:"currentColor"})]}),ke=()=>e.jsxs(Te,{children:[e.jsx(Ie,{children:e.jsx(Me,{children:e.jsx(Se,{})})}),e.jsx(Pe,{children:"Graph Mindset"})]}),Te=f(j).attrs({align:"center",direction:"row",grow:1,justify:"flex-start"})`
  height: 64px;
  box-sizing: border-box;
  padding: 20px 23px;
  gap: 0px;
  z-index: 50;
  position: relative;
`,Ie=f(j)`
  align-items: center;
  justify-content: center;
  cursor: pointer;
`,Me=f.div`
  display: flex;
  align-items: center;
  justify-content: center;

  svg {
    width: 30px;
    height: 27px;
    color: ${v.white};
  }
`,Pe=f(ae)`
  width: 127px;
  height: 24px;
  color: ${v.white};
  font-family: Barlow;
  font-size: 22px;
  font-style: normal;
  font-weight: 700;
  line-height: 24px;
  letter-spacing: 0.22px;
  margin-left: 16px;
  white-space: nowrap;
`,Q=o.memo(()=>{const t=H(a=>a.isPlaying),i=H(a=>a.setIsPlaying),s=H(a=>a.setVolume),r=H(a=>a.setPlaybackSpeed),c=H(a=>a.playbackSpeed),n=H(a=>a.playerRef),[x,w]=o.useState(!1),h=[.5,1,1.5,2],g=()=>{if(n){const a=n.getCurrentTime()-15;n.seekTo(a,"seconds")}},p=()=>{if(n){const a=n.getCurrentTime()+15;n.seekTo(a,"seconds")}},b=()=>{i(!t)},d=()=>{w(!x),s(x?1:0)},m=()=>{const I=(h.indexOf(c)+1)%h.length,W=h[I];if(r(W),n){const M=n.getInternalPlayer();M&&typeof M.playbackRate<"u"&&(M.playbackRate=W)}};return e.jsxs(_e,{children:[e.jsx(Ne,{onClick:d,children:x?e.jsx(we,{}):e.jsx(Ce,{})}),e.jsx(Ee,{onClick:g,children:e.jsx("img",{alt:"",src:"/RewindIcon.svg"})}),e.jsx($e,{"data-testid":"play-pause-button",onClick:b,size:"small",children:t?e.jsx(me,{"data-testid":"pause-icon"}):e.jsx(ge,{"data-testid":"play-icon"})}),e.jsx(Re,{onClick:p,children:e.jsx("img",{alt:"",src:"/ForwardIcon.svg"})}),e.jsxs(He,{onClick:m,children:[c,"x"]})]})});Q.displayName="Controls";const _e=f(j).attrs({direction:"row",align:"center",justify:"flex-start"})`
  width: 200px;
  height: 54px;
  background: ${v.BG1};
  border-radius: 40px;
  margin-right: 30px;
  color: ${v.white};
  font-size: 20px;
  padding: 12px;
  justify-content: space-between;
  box-sizing: border-box;
`,$e=f(xe)`
  && {
    font-size: 36px;
    padding: 2px;
    overflow: hidden;
  }
`,Ee=f.div`
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 1px 0 0 1px;
  cursor: pointer;
  img {
    width: 20px;
    height: auto;
  }
`,Re=f.div`
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  img {
    width: 24px;
    height: auto;
  }
`,Ne=f.div`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  cursor: pointer;
  border-radius: 50%;
  transition: background-color 0.3s ease;
  color: ${v.GRAY6};

  svg {
    margin-top: 3px;
    width: 24px;
    height: 24px;
  }

  &:hover {
    background-color: ${v.DROPDOWN_BG};
  }
`,He=f.button`
  margin-top: 4px;
  background: ${v.BG1};
  color: ${v.GRAY6};
  border: none;
  width: 8px;
  border-radius: 20px;
  padding: 8px 20px 8px 8px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s ease;
`,ee=o.memo(({left:t,width:i,title:s})=>e.jsx(We,{style:{left:`${t}%`,width:`calc(${i}%)`},children:e.jsx("div",{className:"title",children:s})}));ee.displayName="Chapter";const We=f.div`
  position: absolute;
  top: -3px;
  height: 100%;
  top: 0%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;

  & + & {
    border-left: 0.1px solid ${v.white};
  }

  .title {
    position: absolute;
    bottom: calc(100% + 16px);
    display: none;
    color: ${v.white};
    text-align: center;
    left: 50%;
    transform: translateX(-50%);
  }

  &:hover {
    background-color: rgba(255, 255, 255, 0.2);
    .title {
      display: block;
    }
  }
`,te=o.memo(({chapters:t,duration:i})=>i?e.jsx(e.Fragment,{children:t.map((s,r)=>{var g,p,b,d;const c=(g=s==null?void 0:s.properties)!=null&&g.timestamp?Z(s.properties.timestamp)/1e3:0,n=(b=(p=t[r+1])==null?void 0:p.properties)!=null&&b.timestamp?Z((d=t[r+1].properties)==null?void 0:d.timestamp)/1e3:i,x=Math.floor(c/i*100),h=Math.floor(n/i*100)-x;return e.jsx(ee,{left:x,title:s.name,width:h},`${s.ref_id}_${r}`)})}):null);te.displayName="Chapters";const re=o.memo(({type:t,left:i,img:s})=>{var h,g;const r=J(p=>p.normalizedSchemasByType),c=(h=r[t])==null?void 0:h.primary_color,n=(g=r[t])==null?void 0:g.icon,x=n?`/svg-icons/${n}.svg`:"",w={iconStart:s||x,color:c??v.THING};return e.jsx(Be,{style:{left:`${i}%`},children:e.jsx(se,{...w,label:t})})});re.displayName="Marker";const se=o.memo(({iconStart:t,color:i,label:s})=>e.jsx(Fe,{color:i,children:t&&e.jsx("img",{alt:s,className:"badge__img",onError:console.log,src:t})}));se.displayName="Badge";const Fe=f(j).attrs({direction:"row"})`
  cursor: pointer;
  background: ${({color:t})=>t};
  border-radius: 3px;
  overflow: hidden;
  justify-content: center;
  align-items: center;

  .badge__img {
    width: 10px;
    height: 10px;
    object-fit: contain;
  }
`,Be=f.div`
  position: absolute;
  top: -6px;
  width: 12px;
  height: 12px;
  border-radius: 4px;
  background-color: ${v.white};
  transform: translateX(-50%);
  transform: translateX(-50%) translateY(-50%);
  top: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
`,oe=o.memo(({markers:t,duration:i})=>e.jsx(e.Fragment,{children:t.map((s,r)=>{var w;const c=Math.floor(((s==null?void 0:s.start)||0)/i*100),n=(s==null?void 0:s.node_type)||"",x=((w=s==null?void 0:s.properties)==null?void 0:w.image_url)||"";return e.jsx(re,{img:x,left:c,type:n},`${s.ref_id}_${r}`)})}));oe.displayName="Markers";const Ae=({duration:t,markers:i,handleProgressChange:s,playingTIme:r,chapters:c})=>{const n=10/t*100;return e.jsxs(ze,{children:[e.jsx(Le,{max:t,onChange:s,value:r,width:n}),c&&e.jsx(ne,{children:e.jsx(te,{chapters:c,duration:t})}),e.jsx(Ge,{children:e.jsx(oe,{duration:t,markers:i})})]})},ne=f(j)`
  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  height: 96px;
  transform: translateY(-50%);
`,ze=f(j)`
  position: relative;
  flex: 1 1 100%;

  &:hover {
    ${ne} {
      display: block;
    }
  }
`,Ge=f(j)`
  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
`,Le=f(be)`
  && {
    z-index: 20;
    color: ${v.white};
    height: 3px;
    width: calc(100% - 12px);
    box-sizing: border-box;
    .MuiSlider-track {
      border: none;
    }
    .MuiSlider-thumb {
      width: ${({width:t})=>`${t}%`};
      height: 54px;
      border-radius: 8px;
      background-color: ${v.primaryBlue};
      opacity: 0.2;
      &:before {
        box-shadow: '0 4px 8px rgba(0,0,0,0.4)';
      }
      &:hover,
      &.Mui-focusVisible,
      &.Mui-active {
        box-shadow: none;
      }
    }
  }
`,Ze=({markers:t,chapters:i})=>{const{playingNode:s,playerRef:r}=H(g=>g),[c,n]=o.useState(0),x=s,w=o.useCallback((g,p)=>{const b=Array.isArray(p)?p[0]:p;r&&r.seekTo(b,"seconds")},[r]);o.useEffect(()=>{const g=setInterval(()=>{if(r&&n){const p=r.getCurrentTime();n(p)}},500);return()=>clearInterval(g)},[r,n]);const h=(r==null?void 0:r.getDuration())||0;return x?e.jsxs(Ve,{children:[e.jsx(Q,{}),e.jsx(Ae,{chapters:i,duration:h,handleProgressChange:w,markers:t,playingTIme:c})]}):null},Ve=f(j).attrs({direction:"row",align:"center",justify:"space-between"})`
  padding: 20px;
  background: ${v.BG2};
  height: 96px;
  /* margin-top: 16px; */
  border-radius: 8px;
  box-sizing: border-box;
  margin-right: 4px;
`,De=(t,i)=>{let s=0,r=t.length-1;for(;s<=r;){const c=Math.floor((s+r)/2),n=t[c],{start:x,end:w}=n.properties;if(i>=x&&i<=w)return n;i<x?r=c-1:s=c+1}return null},Oe=({mediaUrl:t})=>{const i=o.useRef(null),[s,r]=o.useState("ready"),[c,n]=o.useState(!1),{setActiveEdge:x}=K(C=>C),{dataInitial:w}=Y(C=>C),{isPlaying:h,playingTime:g,setIsPlaying:p,setPlayingTime:b,setDuration:d,playingNode:m,volume:a,setHasError:I,resetPlayer:W,isSeeking:M,setIsSeeking:z,setPlayerRef:A,playerRef:k,playbackSpeed:V}=H(C=>C);o.useEffect(()=>()=>W(),[W]),o.useEffect(()=>{m&&!c&&(b(0),d(0),n(!1))},[m,b,d,n,c]),o.useEffect(()=>{M&&k&&(k.seekTo(g,"seconds"),z(!1))},[g,M,z,k]);const D=o.useCallback(()=>{p(!h)},[h,p]),u=()=>{I(!0),r("error")},l=o.useCallback(C=>{C.code},[D]);o.useEffect(()=>(window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}),[l]);const y=o.useMemo(()=>((w==null?void 0:w.links.filter(S=>{var $;return($=S==null?void 0:S.properties)==null?void 0:$.start}))||[]).slice().sort((S,$)=>{var T,B;return((T=S==null?void 0:S.properties)==null?void 0:T.start)-((B=$==null?void 0:$.properties)==null?void 0:B.start)}),[w]),P=C=>{if(!M){const F=C.playedSeconds,S=De(y,F);x(S||null)}},E=()=>{k&&r("ready")},_=o.useCallback(()=>{h||p(!0)},[p,h]),N=o.useCallback(()=>{h&&p(!1)},[p,h]),R=C=>{C.stopPropagation()},G=o.useCallback(C=>{!k&&C&&A(C)},[A,k]);return t?e.jsxs(qe,{ref:i,tabIndex:0,children:[e.jsx(Xe,{isFullScreen:!1,children:e.jsx(ce,{size:120,src:(m==null?void 0:m.image_url)||"",type:"clip"})}),e.jsx(Ue,{isFullScreen:!1,onClick:R,children:e.jsx(je,{ref:G,height:"219px",onBuffer:()=>r("buffering"),onBufferEnd:()=>r("ready"),onError:u,onPause:N,onPlay:_,onProgress:P,onReady:E,playbackRate:V,playing:h,url:t||"",volume:a,width:"100%"})}),s==="error"?e.jsx(Ye,{className:"error-wrapper",children:"Error happened, please try later"}):null]}):null},qe=f(j)`
  border-bottom: 1px solid rgba(0, 0, 0, 0.25);
  background: rgba(0, 0, 0, 0.2);
  position: relative;
  overflow: hidden;
  height: auto;
  &:focus {
    outline: none;
  }
`,Xe=f(j)`
  position: absolute;
  top: ${t=>t.isFullScreen?"38%":"18%"};
  left: 50%;
  transform: translateX(-50%);
  z-index: -1;
`,Ye=f(j)`
  height: 60px;
  padding: 12px 16px;
  color: ${v.primaryRed};
`,Ue=f.div`
  margin: ${t=>t.isFullScreen?"80px auto":"0"};
  width: 100%;
  cursor: pointer;
`,Je=o.memo(Oe),ie=o.forwardRef(({active:t,start:i,text:s},r)=>e.jsxs(Ke,{ref:r,className:le({active:t}),children:[e.jsx(Qe,{children:i}),e.jsx(et,{children:e.jsx("span",{children:s})})]}));ie.displayName="ParagraphComponent";const X=o.memo(ie,(t,i)=>t.active===i.active),Ke=f(j)`
  flex-direction: row;
  align-items: flex-start;
  font-size: 14px;
  padding: 8px 24px;
  &.active {
    background: ${v.AI_HIGHLIGHT};
  }
`,Qe=f.span`
  background: ${v.lightBlue100};
  color: ${v.lightBlue500};
  padding: 2px;
  margin-right: 8px;
  border-radius: 4px;
`,et=f.div`
  margin: 0 2px;
  word-break: break-word;

  &.active {
    background: ${v.AI_HIGHLIGHT};
  }
`,tt=({transcriptString:t,isFirst:i})=>{const[s,r]=o.useState(0),[c,n]=o.useState(!1),{playerRef:x}=H(d=>d),w=t.replace(/^["']|["']$/g,""),h=JSON.parse(w),g=o.useRef(null),p=o.useRef(null),b=o.useRef(null);return o.useEffect(()=>{const d=setInterval(()=>{if(x&&r){const m=x.getCurrentTime();r(m)}},100);return()=>clearInterval(d)},[x,r]),o.useEffect(()=>{const d=()=>{n(!0),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{n(!1)},1e3)},m=p.current;return m&&m.addEventListener("scroll",d),()=>{m&&m.removeEventListener("scroll",d)}},[]),o.useEffect(()=>{!c&&g.current&&g.current.scrollIntoView({behavior:"smooth",block:"center"})},[s,c]),e.jsx(rt,{ref:p,children:e.jsx(e.Fragment,{children:i?e.jsx(e.Fragment,{children:h[0].start>s?e.jsx(X,{active:!1,start:q(h[0].start),text:h[0].text}):e.jsx(e.Fragment,{children:h.map(d=>{const m=q(d.start),a=d.start<s&&s<d.end;return!i||d.start<=s+5?e.jsx(X,{ref:a?g:null,active:a,start:m,text:d.text},`${d.start}-${d.end}`):null})})}):e.jsx(e.Fragment,{children:h.map(d=>{const m=q(d.start),a=d.start<s&&s<d.end;return e.jsx(X,{ref:a?g:null,active:a,start:m,text:d.text},`${d.start}-${d.end}`)})})})})},rt=f.div`
  width: 100%;
  height: 100%;
  overflow: scroll;
  padding-right: 4px;
`,st=({name:t})=>{var m;const i=L(a=>a.clips),{playerRef:s}=H(a=>a),[r,c]=o.useState(0),[n,x]=o.useState(null),[w,h]=o.useState(!0),[g,p,b]=K(a=>[a.setActiveNode,a.activeNode,a.simulation]);o.useEffect(()=>{const a=setInterval(()=>{if(s&&c){const I=s.getCurrentTime();c(I)}},100);return()=>clearInterval(a)},[s,c]),o.useEffect(()=>{r&&(()=>{var W;const I=i.find(M=>{var k;const[z,A]=d((k=M==null?void 0:M.properties)==null?void 0:k.timestamp);return z<=r&&r<A});n&&(I==null?void 0:I.ref_id)===(n==null?void 0:n.ref_id)||!I||(h((I==null?void 0:I.ref_id)===((W=i[0])==null?void 0:W.ref_id)),x(I||null))})()},[r,i,n]),o.useEffect(()=>{if(n&&(!p||n.ref_id!==p.ref_id)){const a=b==null?void 0:b.nodes().find(I=>I.ref_id===n.ref_id);typeof(a==null?void 0:a.fx)=="number"&&g(a)}},[n,p,g,b]);const d=a=>a?a.split("-").map(Number):[0,0];return e.jsxs(ot,{children:[e.jsx(j,{className:"heading",children:t}),n?e.jsx(nt,{direction:"row",children:((m=n.properties)==null?void 0:m.transcript)&&e.jsx(tt,{isFirst:w,transcriptString:n.properties.transcript})}):null]})},ot=f(j)`
  .heading {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 16px;
  }
  color: ${v.white};
  background: ${v.BG1};
  border-radius: 8px;
  padding: 24px;
  overflow-y: auto;
  flex: 1 1 100%;
`,nt=f(j)`
  flex-wrap: wrap;
  flex: 1 1 100%;
  margin-left: -24px;
  margin-right: -24px;
`,it=()=>{var i;const t=L(s=>s.selectedEpisode);return e.jsxs(at,{align:"stretch",basis:"100%",grow:1,shrink:1,children:[e.jsx(ct,{children:((i=t==null?void 0:t.properties)==null?void 0:i.source_link)&&e.jsx(Je,{mediaUrl:t.properties.source_link})}),e.jsx(st,{name:(t==null?void 0:t.name)||""})]})},at=f(j)(({theme:t})=>({position:"relative",display:"flex",padding:"0 20px 0 20px",background:"transparent",width:"100%",height:"calc(100vh - 180px)",overflow:"auto",[t.breakpoints.up("sm")]:{width:ve,gap:"10px"}})),ct=f(j)(({theme:t})=>({width:"100%",marginBottom:"20px",[t.breakpoints.up("sm")]:{width:"390px",margin:"0 auto"}})),lt=t=>{const i=t.edges.filter(r=>{var c;return(c=r==null?void 0:r.properties)==null?void 0:c.start}).map(r=>({source:r.source,target:r.target,start:r.properties.start}));return t.nodes.filter(r=>t.edges.some(c=>c.source===r.ref_id||c.target===r.ref_id)).map(r=>{const c=i.find(n=>r.ref_id===n.source||r.ref_id===n.target);return{...r,start:(c==null?void 0:c.start)||0}}).filter(r=>r&&r.node_type!=="Clip"&&r.node_type!=="Episode"&&r.node_type!=="Show")},Lt=()=>{const{isFetching:t,runningProjectId:i}=Y(u=>u),s=Y(u=>u.addNewNode),[r,c]=o.useState(!1),n=L(u=>u.setSelectedEpisode),x=L(u=>u.setClips),w=L(u=>u.clips),h=L(u=>u.setChapters),g=L(u=>u.chapters),p=ye(),b=o.useRef(null),d=o.useRef(null),m=o.useRef(null),[a,I]=o.useState([]),{setSchemas:W}=J(u=>u),M=o.useRef(null),z=o.useRef(null),A=pe(),{episodeId:k}=de(),{setPlayingNode:V}=H(u=>u);o.useEffect(()=>{(async()=>{try{const l=await ue();W(l.schemas.filter(y=>!y.is_deleted))}catch(l){console.error("Error fetching schema:",l)}})()},[W]),o.useEffect(()=>{k&&(async l=>{try{const y=await fe(l);y&&(V(y),n(y),s({nodes:[y],edges:[]}))}catch(y){A("/"),console.error(y)}})(k)},[k,V,n,s,A]),o.useEffect(()=>{k&&(async()=>{try{const l=await O(k||"",0,50,{nodeType:["Show","Host","Guest"],useSubGraph:!1}),y=await O(k||"",0,1e3,{nodeType:["Clip"],useSubGraph:!1});if(s({nodes:l!=null&&l.nodes?l==null?void 0:l.nodes:[],edges:l!=null&&l.edges?l.edges:[]}),y!=null&&y.nodes){const P=y.nodes.filter(E=>{var _;return(_=E.properties)==null?void 0:_.timestamp}).sort((E,_)=>{var G,C,F,S;const N=Number((C=(G=E.properties)==null?void 0:G.timestamp)==null?void 0:C.split("-")[0]),R=Number((S=(F=_.properties)==null?void 0:F.timestamp)==null?void 0:S.split("-")[0]);return N-R});x(P)}}catch(l){A("/"),console.error("Error fetching initial data:",l)}})()},[k,s,x,A]),o.useEffect(()=>{k&&(async()=>{try{const l=await O(k||"",0,50,{nodeType:["Chapter"],useSubGraph:!1});if(l!=null&&l.nodes){const y=l==null?void 0:l.nodes.filter(P=>P.node_type==="Chapter").sort((P,E)=>{var _,N;return Z(((_=P==null?void 0:P.properties)==null?void 0:_.timestamp)||"")-Z(((N=E==null?void 0:E.properties)==null?void 0:N.timestamp)||"")});h(y)}}catch{console.log("no chapters was fetched")}})()},[k,h]),o.useEffect(()=>{if(!w||!g)return;(async()=>{var l,y;try{const P=(w==null?void 0:w.map(N=>N.ref_id).filter(Boolean))||[],E=[],_={nodes:((l=m.current)==null?void 0:l.nodes)||[],edges:((y=m.current)==null?void 0:y.edges)||[]};for(const N of P){const R=await O(N,0,50);if(R){const C=lt(R).map(F=>{var $;const S=(($=g.find(T=>{var B;return F.start&&Z(((B=T==null?void 0:T.properties)==null?void 0:B.timestamp)||"")>=F.start*1e3}))==null?void 0:$.ref_id)||"";return{...F,neighbourHood:S}});_.nodes.push(...C||[]),_.edges.push(...(R==null?void 0:R.edges)||[]),E.push(...C),m.current=_}}I(E)}catch(P){console.error("Error processing clip nodes:",P)}})()},[w,I,g]);const D=o.useCallback(u=>{t||(M.current||(M.current={nodes:[],edges:[]}),u.edges&&M.current.edges.push(...u.edges),u.nodes&&M.current.nodes.push(...u.nodes),z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{if(M.current){const{nodes:l,edges:y}=M.current,P={nodes:l,edges:y};M.current={nodes:[],edges:[]},s(P)}},3e3))},[s,t]);return o.useEffect(()=>(p&&(p.connect(),p.on("connect_error",u=>{console.error("Socket connection error:",u)}),i&&p.on("new_node_created",D)),()=>{p&&p.off()}),[p,D,i]),o.useEffect(()=>{const u=l=>{const{playerRef:y}=H.getState();if(d.current!==null){if(l-d.current>1e3){if(m.current&&y){const{nodes:E,edges:_}=m.current,N=y==null?void 0:y.getCurrentTime(),[R,G]=_.reduce(([S,$],T)=>{var B,U;return((B=T==null?void 0:T.properties)==null?void 0:B.start)!==void 0&&((U=T==null?void 0:T.properties)==null?void 0:U.start)<N+1?S.push(T):$.push(T),[S,$]},[[],[]]),[C,F]=E.reduce(([S,$],T)=>(R.some(B=>B.target===T.ref_id||B.source===T.ref_id)?S.push(T):$.push(T),[S,$]),[[],[]]);m.current={nodes:F,edges:G},(C.length||R.length)&&s({nodes:C,edges:R})}d.current=l}}else d.current=l;b.current=requestAnimationFrame(u)};return b.current=requestAnimationFrame(u),()=>{b.current&&cancelAnimationFrame(b.current)}},[m,s]),o.useEffect(()=>{if(i)try{p==null||p.emit("update_project_id",{id:i})}catch(u){console.error(u)}},[i,p]),e.jsxs(pt,{children:[e.jsx(dt,{direction:"row",children:e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsx(j,{onClick:()=>c(!r),children:e.jsx(ke,{})}),e.jsx(it,{})]}),e.jsx(ut,{children:e.jsx(j,{basis:"100%",grow:1,shrink:1,children:e.jsx(he,{})})})]})}),e.jsx(ft,{children:e.jsx(Ze,{chapters:g,markers:a})})]})},pt=f.div`
  display: flex;
  flex-direction: column;
  height: 100vh;
  width: 100%;
`,dt=f(j)`
  flex: 1;
  overflow: hidden;
`,ut=f(j)`
  flex-basis: 100%;
  flex-shrink: 1;
  flex-grow: 1;
  padding: 16px 16px 16px 0;
`,ft=f(j)`
  padding: 16px 16px 16px 0;
  margin-left: 18px;
`;export{Lt as MindSet};
